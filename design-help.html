<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>We Help You Design - Card Force</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="outdated-mode.js"></script>
    <script src="admin-utils.js"></script>
    <style>
        body { font-family:'Raleway',sans-serif; background:#f8f7fb; color:#333; margin:0; }
        .navbar { background: linear-gradient(135deg, #6a4c93, #8e44ad); padding:0.5rem 0; position:sticky; top:0; z-index:10; }
        .nav-container { max-width:1200px; margin:0 auto; padding:0 1.25rem; display:flex; justify-content:space-between; align-items:center; }
        .logo { color:#fff; text-decoration:none; font-weight:800; font-size:1.2rem; display:flex; align-items:center; gap:10px; }
        .logo-icon { width:40px; height:48px; background:#2c2c2c; border:3px solid #1a1a1a; border-radius:8px; display:flex; align-items:center; justify-content:center; }
        .logo-text { color:#fff; font-size:0.6rem; font-weight:800; line-height:0.8; text-align:center; }
        .logo-divider { width:24px; height:2px; background:#1a1a1a; margin:2px 0; }

        .nav-menu { display:flex; list-style:none; gap:1rem; }
        .nav-menu a { color:#fff; text-decoration:none; padding:0.35rem 0.75rem; border-radius:25px; transition:all 0.3s ease; font-weight:500; }
        .nav-menu a:hover { background-color:rgba(255,255,255,0.2); transform:translateY(-2px) scale(1.05); box-shadow:0 4px 8px rgba(106,76,147,0.4); }

        .container { max-width:1100px; margin:18px auto; padding:0 1.25rem; display:grid; grid-template-columns: 1fr 320px; gap:16px; }
        .panel { background:#fff; border:1px solid #eee; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.06); overflow:hidden; }
        .panel-header { padding:10px 12px; border-bottom:1px solid #f0f0f0; font-weight:700; color:#6a4c93; }
        .chat { display:flex; flex-direction:column; height:70vh; }
        .chat-messages { flex:1; overflow:auto; padding:12px; background:#fafafa; }
        .chat-input { display:flex; gap:8px; padding:10px; border-top:1px solid #eee; align-items:center; }
        .chat-input input[type="text"] { flex:1; padding:10px; border:1px solid #ddd; border-radius:10px; }
        .btn { background: linear-gradient(135deg, #6a4c93, #8e44ad); color:#fff; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; }
        .side { padding:12px; }
        .note { font-size:0.9rem; color:#666; margin-top:6px; }
        .recorder { display:flex; gap:8px; align-items:center; }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; gap: 12px; }
            .chat { height: 60vh; }
            .chat-input { flex-wrap: wrap; }
            .chat-input input[type="text"] { margin-bottom: 8px; }
            .btn { margin: 2px; }
            .nav-menu { position: fixed; top: 0; right: -100%; width: 100%; height: 100vh; background: linear-gradient(135deg, #6a4c93, #8e44ad); flex-direction: column; justify-content: center; align-items: center; gap: 2rem; transition: right 0.3s ease; z-index: 1000; }
            .nav-menu.active { right: 0; }
            .hamburger { display: flex; }
        }
        
        @media (min-width: 769px) {
            .hamburger { display: none; }
        }
    </style>
</head>
<body>
    <div style="background: #ff6b6b; color: white; padding: 1rem; text-align: center; font-weight: bold; position: fixed; top: 0; left: 0; right: 0; z-index: 10000;">
        ðŸš§ Design Help is temporarily disabled. Coming Soon! ðŸš§
    </div>
    
    <div style="margin-top: 4rem; padding: 2rem; text-align: center; background: #f8f9fa; border-radius: 10px; margin: 4rem 1rem 1rem 1rem; position: relative; z-index: 10001;">
        <h2 style="color: #6a4c93; margin-bottom: 1rem;">Design Help Coming Soon!</h2>
        <p style="color: #666; margin-bottom: 1rem;">We're working hard to bring you an amazing design help experience.</p>
        <p style="color: #666; margin-bottom: 2rem;">In the meantime, check out our trading cards!</p>
        <a href="trading-cards.html" style="background: #6a4c93; color: white; padding: 1rem 2rem; border-radius: 25px; text-decoration: none; font-weight: bold;">Browse Trading Cards</a>
    </div>
    
    <style>
        .navbar,
        .main-content,
        .chat-container,
        .chat-messages,
        .chat-input,
        body > *:not(.coming-soon-message) {
            filter: blur(5px);
            pointer-events: none;
            opacity: 0.3;
        }
        
        .coming-soon-message {
            filter: none !important;
            pointer-events: auto !important;
            opacity: 1 !important;
        }
    </style>
    
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <div class="logo-text">
                        <div>CARD</div>
                        <div class="logo-divider"></div>
                        <div>FORCE</div>
                    </div>
                </div>
                <span>Card Force</span>
            </a>
            <div class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html" onclick="closeMenu()">Home</a></li>
                <li><a href="shop.html" onclick="closeMenu()">Shop</a></li>
                <li><a href="marketplace.html" onclick="closeMenu()">Marketplace</a></li>
                <li><a href="help.html" onclick="closeMenu()">Help</a></li>
                <li><a href="account.html" onclick="closeMenu()">Account</a></li>
                <li><a href="#" onclick="goToCart(); closeMenu()">Cart</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="panel">
            <div class="panel-header">Live Design Chat</div>
            <div class="chat">
                <div id="chatMessages" class="chat-messages"></div>
                <div class="chat-input">
                    <input id="chatText" type="text" placeholder="Describe your idea..." />
                    <label for="chatImage" class="btn">Image</label>
                    <input id="chatImage" type="file" accept="image/*" style="display:none" />
                    <div class="recorder">
                        <button id="recBtn" class="btn" onclick="toggleRecording()">Record</button>
                        <span id="recStatus" style="font-size:0.85rem;color:#666"></span>
                    </div>
                    <button class="btn" onclick="sendChatMessage()">Send</button>
                </div>
            </div>
        </div>
        <div class="panel side">
            <div style="font-weight:800;color:#6a4c93;">Tips</div>
            <div class="note">Do not share personal information. This is a live person.</div>
            <div class="note">Add photos and describe your idea so our staff can help.</div>
        </div>
    </div>

    <script>
        // Require sign-in
        const savedUser = localStorage.getItem('googleUser');
        if (!savedUser) { 
            alert('Please sign in to chat with a designer! ðŸ’¬');
            window.location.href='account.html';
        }
        const user = JSON.parse(savedUser);
        const convo = getOrCreateConversationForUser(user);

        function renderChat() {
            const c = getConversation(convo.id);
            const box = document.getElementById('chatMessages');
            box.innerHTML = (c.messages||[]).map(m => {
                const align = m.from==='admin' ? 'flex-end' : 'flex-start';
                const bg = m.from==='admin' ? '#e8f5e9' : '#f1f3f5';
                if (m.type==='image') return `<div style="display:flex;justify-content:${align};margin:6px 0;"><div style="background:${bg};padding:6px 8px;border-radius:8px;max-width:80%"><img src="${m.src}" style="max-width:240px;border-radius:8px"/></div></div>`;
                if (m.type==='audio') return `<div style="display:flex;justify-content:${align};margin:6px 0;"><div style="background:${bg};padding:6px 8px;border-radius:8px;max-width:80%"><audio controls src="${m.src}"></audio></div></div>`;
                if (m.type==='prompt') return `<div style="display:flex;justify-content:center;margin:8px 0;"><div style="background:#fff3cd;border:1px solid #ffeeba;padding:10px;border-radius:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;">Add to cart? <button class='btn' onclick="sendPromptResponse('No')">No</button> <button class='btn' onclick="sendPromptResponse('Yes')">Yes</button> <button class='btn' onclick="sendPromptResponse('Preview cards')">Preview cards</button></div></div>`;
                return `<div style="display:flex;justify-content:${align};margin:6px 0;"><div style="background:${bg};padding:8px 10px;border-radius:8px;max-width:80%">${m.text||''}</div></div>`;
            }).join('');
            box.scrollTop = box.scrollHeight;
        }

        function sendPromptResponse(choice) {
            appendMessage(convo.id, { from:'user', type:'text', text:`Customer: ${choice}` });
            renderChat();
        }

        function sendChatMessage() {
            const text = (document.getElementById('chatText').value||'').trim();
            const imgFile = document.getElementById('chatImage').files[0] || null;
            if (!text && !imgFile && !pendingAudioBlob) return;
            if (text) appendMessage(convo.id, { from:'user', type:'text', text });
            if (imgFile) {
                const r = new FileReader();
                r.onload = e => { appendMessage(convo.id, { from:'user', type:'image', src:e.target.result }); renderChat(); };
                r.readAsDataURL(imgFile);
                document.getElementById('chatImage').value='';
            }
            if (pendingAudioBlob) {
                const reader = new FileReader();
                reader.onload = e => { appendMessage(convo.id, { from:'user', type:'audio', src:e.target.result }); renderChat(); };
                reader.readAsDataURL(pendingAudioBlob);
                pendingAudioBlob = null;
            }
            document.getElementById('chatText').value='';
            renderChat();
        }

        // Microphone recording via MediaRecorder
        let mediaRecorder = null;
        let audioChunks = [];
        let pendingAudioBlob = null;

        async function toggleRecording() {
            const btn = document.getElementById('recBtn');
            const status = document.getElementById('recStatus');
            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    mediaRecorder.ondataavailable = e => { if (e.data.size > 0) audioChunks.push(e.data); };
                    mediaRecorder.onstop = () => {
                        pendingAudioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        status.textContent = 'Voice recorded';
                        // Auto-send the voice message
                        setTimeout(() => {
                            sendChatMessage();
                        }, 500);
                    };
                    mediaRecorder.start();
                    btn.textContent = 'Stop';
                    status.textContent = 'Recording...';
                } catch (e) {
                    alert('Please allow microphone access to record voice messages!');
                }
            } else {
                mediaRecorder.stop();
                btn.textContent = 'Record';
                status.textContent = 'Processing...';
                // Stop all tracks to turn off microphone
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }
        }

        // Hamburger menu functions
        function toggleMenu() {
            const navMenu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger');
            
            navMenu.classList.toggle('active');
            hamburger.classList.toggle('active');
        }

        function closeMenu() {
            const navMenu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger');
            
            navMenu.classList.remove('active');
            hamburger.classList.remove('active');
        }

        function goToCart() {
            const googleUser = localStorage.getItem('googleUser');
            if (!googleUser) {
                alert('Please sign in to access your cart! ðŸ›’');
                window.location.href = 'account.html';
                return;
            }
            window.location.href = 'cart.html';
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const navMenu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger');
            const navbar = document.querySelector('.navbar');
            
            if (!navbar.contains(event.target) && navMenu.classList.contains('active')) {
                closeMenu();
            }
        });

        // Close menu on window resize if screen becomes larger
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                closeMenu();
            }
        });

        // Seed an info message on first open
        appendMessage(convo.id, { from:'system', type:'info', text:'Please add photos and describe your idea so our staff can help.' });
        renderChat();
    </script>
</body>
</html>

